# JaWT Scratchpad

## Information

- picoCTF 2019
- Web Exploitation
- 400 Points

## Description

_Internal server errors can be intentionally returned by this challenge. If you experience one, try clearing your cookies._

Check the admin scratchpad! https://jupiter.challenges.picoctf.org/problem/58210/ or http://jupiter.challenges.picoctf.org:58210

## Hints

1. What is that cookie?

2. Have you heard of JWT?

## Solution

Going to the webpage, we find an online scratchpad where we need to entire a name that is not "admin".

![initial webpage](images/initial.PNG)

Entering a name, say "John", leads us to an updated version with the actual scratchpad.

![updated webpage with scratchpad](images/with_name.PNG)

Looking at the cookies for this webpage, we see one with the name `jwt` with a value of `eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiSm9obiJ9.K1Omo0Gk5saKwJTkkgT7PUZohD7USknEE0lmT2AYAiM`. Decoding the cookie at https://jwt.io/ gives us the following:

```
Header:
{
  "typ": "JWT",
  "alg": "HS256"
}

Payload:
{
  "user": "John"
}

Verify Signature:
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  secret
)
```

We want to change the user to `admin` and then re-encode the cookie. However, we need the `secret`. To find the secret key, we use [John the Ripper](https://www.openwall.com/john/). We also need a wordlist to check all possible secret keys, one of these wordlists is the [rockyou wordlist](https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt). To find the secret key place the original cookie value into a textfile called `jwt.txt`, and then use the command `john jwt.txt — wordlist=wordlist.txt — format=HMAC-SHA256` using a terminal inside the `run` folder of John the Ripper. This should reveal the secret key to be `ilovepico`.

Go back to https://jwt.io/, and change the decoded cookie value to:

```
Header:
{
  "typ": "JWT",
  "alg": "HS256"
}

Payload:
{
  "user": "admin"
}

Verify Signature:
HMACSHA256(
  base64UrlEncode(header) + "." +
  base64UrlEncode(payload),
  ilovepico
)
```

This should produce an encoded value of `eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyIjoiYWRtaW4ifQ.gtqDl4jVDvNbEe_JYEZTN19Vx6X9NNZtRVbKPBkhO-s`. Replace the old value with this new value and the flag should appear in the scratchpad.

## Flag

picoCTF{jawt_was_just_what_you_thought_44c752f5}
